language: bash

services:
  - docker

env:
  global:
    # change the registry name and username/password to yourself's.
    - ALI_REGISTRY=registry.cn-hongkong.aliyuncs.com/ybinkubeflow

before_script:
  - docker login --username=$ALI_USERNAME --password=$ALI_PASSWORD $ALI_REGISTRY
 
script:
  - echo "start pull and retag and push"
  - |
    for image in $(cat img-list.txt)
    do
      image_name=${image##*/}
      image_name=${image_name%@*}
      image_tag=`echo $image | awk -F '/' '{print $NF}' | awk -F ':' '{print $2}'`
      image_tag=`echo $image | awk -F '/' '{print $NF}' | awk -F '@' '{print $2}'`
      docker pull $image
      docker tag $image $ALI_REGISTRY/$image_name:$image_tag
    	
      # push到阿里云仓库
      docker push $ALI_REGISTRY/$image_name:$image_tag
    done

